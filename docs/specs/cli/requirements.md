# cli モジュール要件定義

## 概要

### 目的

アプリケーションのエントリーポイントとして、CLI インターフェースを提供する。ユーザーからのコマンド入力を受け取り、適切なコンポーネントを組み立てて処理を委譲する。

### 解決する課題

- コマンド引数・環境変数・デフォルト値が散在し、設定の優先順位が不明確になる
- エラー発生時の終了コードや出力先（ログ vs 標準出力）の扱いが統一されない
- サブコマンドの追加に伴い、エントリーポイントの構成が複雑化する

### コンポーネントの概要

- **CLIアプリケーション**: Typerを使用し、サブコマンドのルーティングとグローバルオプションの処理を担当する。各サブコマンドから適切なコンポーネントを組み立てて処理を委譲する

## 機能要件

### コマンド実行

- `uv run example <subcommand>` の形式でサブコマンドを実行できる
- サブコマンドなしで実行した場合はヘルプを表示する
- 設定オプションの優先順位は「CLI引数 > 環境変数 > デフォルト値」とする
- エラーが発生した場合は、エラーログを出力して異常終了させる

### transform サブコマンド

- 指定したテキストファイルを変換し、結果を標準出力へ表示できる
- 処理対象のテキストファイルを、コマンド実行時に指定できる
- 出力先の一時ディレクトリを、コマンド実行時に指定できる（任意）

### グローバルオプション

- アプリケーションのログレベルを、コマンド実行時に指定できる（任意）

## 品質要件

### エラー処理の一貫性

アプリケーション例外と予期しない例外のいずれについても、エラーログを出力したうえで一貫した終了コードで異常終了すること。終了の制御はCLIレイヤーが担い、下位コンポーネントには委譲しない。

### 利用者への明確なフィードバック

不正な引数・必須引数の欠如など、CLIの使い方に関するエラーはTyperの標準機能によって適切なメッセージと終了コードで通知すること。

## CLIインターフェース仕様

### コマンド形式

```
uv run example [OPTIONS] COMMAND [ARGS]...
```

### transform サブコマンド仕様

```
uv run example transform [OPTIONS] TARGET_FILE
```

| パラメータ | 種別 | 必須 | 説明 |
|---|---|---|---|
| `TARGET_FILE` | positional argument | yes | 変換対象ファイルのパス |
| `--tmp-dir PATH` | option | no | 一時ディレクトリパス |

### グローバルオプション

| パラメータ | 種別 | 必須 | 説明 |
|---|---|---|---|
| `--log-level LEVEL` | option | no | ログレベル(CRITICAL/ERROR/WARNING/INFO/DEBUG) |

### 設定値の優先順位

- `--log-level` 引数 > `EXAMPLE_LOG_LEVEL` 環境変数 > デフォルト値(`INFO`)
- `--tmp-dir` 引数 > `EXAMPLE_TMP_DIR` 環境変数 > デフォルト値(`${PWD}/tmp`)

### 終了コード

| 終了コード | 意味 |
|---|---|
| `0` | 正常終了 |
| `1` | 例外発生（エラー処理後） |
| `2` | Typer による引数エラー（不正な引数・必須引数の欠如など） |

## 前提条件

- Typer を使用し、一貫性のあるコマンドラインインターフェイスを実現

## 関連ドキュメント

- [cli モジュール基本設計](./design.md): cli モジュールのアーキテクチャ設計やコンポーネント構成
