# foundation/error パッケージ要件定義書

## 概要

### 目的

アプリケーション全体のエラー処理を標準化するため、例外の定義とログ出力の仕組みを一箇所に集約する。これにより、エラー情報の管理やログの形式が各コンポーネントで分散することを防ぐ。

### 解決する課題

- ユーザー向けメッセージと開発者向け技術情報が区別されず、エラー情報の管理が煩雑になる
- 例外の種類によってログの出力形式が統一されておらず、原因調査に時間がかかる
- エラー処理のロジックが各コンポーネントに分散し、保守コストが増大する

### コンポーネントの概要

以下の 2 つのコンポーネントを提供する。

- **アプリケーション例外の基底クラス**: ユーザー向けメッセージと開発者向け詳細を 1 つの例外オブジェクトに保持する
- **エラーハンドリングコンポーネント**: 例外の種類（アプリケーション例外か汎用例外か）を判別し、それぞれに適したフォーマットでロギングシステムへ記録する。プロセス終了の制御は行わず、ログ出力のみを担当する

## 機能要件

### アプリケーション例外の定義

アプリケーション例外の基底クラスを提供し、以下の情報を保持する。

- ユーザー向けメッセージを保持する（エンドユーザーに提示するための分かりやすい説明）
- 開発者向け詳細を保持する（デバッグや原因調査のための技術的情報）
- 通常の例外と同様に、例外チェーンの文脈で扱える

### エラーログ出力

例外を受け取り、例外の種類に応じてフォーマットを切り替えてログへ記録する。

- アプリケーション例外を受け取った場合、ユーザー向けメッセージと開発者向け詳細を含む形式でログに記録する
- 汎用例外を受け取った場合、例外の内容と根本原因を含む形式でログに記録する
- ログ出力後にプロセスを終了せず、終了の判断を呼び出し元に委ねる

## 品質要件

### 責務の明確な分離

エラーログ出力はログ記録のみを担当し、例外の再送出・変換・プロセス終了は行わない。終了制御の責務を呼び出し元に委ねることで、エラー後の挙動をアプリケーション側で柔軟に決定できる。

### 可観測性

エラー発生時に例外の型・メッセージ・原因を構造化された形式でログへ記録し、問題の調査に必要な情報を提供する。

## 前提条件

### 技術基盤

- Python 標準ライブラリのロギング機構を使用する
- ロギングの設定（ハンドラ・フォーマッタ・ログレベル）は呼び出し元が行う

## 関連ドキュメント

- [foundation/error パッケージ基本設計](./design.md): foundation/error パッケージのアーキテクチャ設計やコンポーネント構成
